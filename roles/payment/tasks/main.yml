

- name : Installing Python3 in {{COMPONENT}}
  ansible.builtin.shell: dnf install python36 gcc python3-devel -y

- name: Creating {{APPUSER}} user
  ansible.builtin.user:
    name: "{{APPUSER}}"

- name: Download and Extracting {{COMPONENT}}
  ansible.builtin.unarchive:
    src: https://github.com/stans-robot-project/{{COMPONENT}}/archive/main.zip
    dest: /tmp
    remote_src: yes

- name: Performing Cleanup
  ansible.builtin.file:
    path: /home/{{APPUSER}}/{{COMPONENT}}
    state: absent

- name: Copying {{COMPONENT}} to {{APPUSER}}
  ansible.builtin.copy:
    src: /tmp/{{COMPONENT}}-main/
    dest: /home/{{APPUSER}}/{{COMPONENT}}/
    owner: "{{APPUSER}}"
    group: "{{APPUSER}}"
    remote_src: yes 

- name: Install specified python requirements
  ansible.builtin.pip:
    requirements: /home/{{APPUSER}}/{{COMPONENT}}/requirements.txt

# - name: Replace id and group id in {{COMPONENT}}.ini
#   ansible.builtin.replace:
#     path: /etc/payment.ini
#     regexp: 'uid'
#     replace: '1000'

# - name: Copying {{COMPONENT}} systemd file
#   ansible.builtin.template:
#     src: systemd.service
#     dest: /etc/systemd/system/{{COMPONENT}}.service

- name: Restarting {{COMPONENT}} service
  ansible.builtin.systemd_service:
    name: "{{COMPONENT}}"
    state: started
    enabled: yes
  